(function () {
    const RED_BIN = [
        0x00, 0x61, 0x73, 0x6D, 0x01, 0x00, 0x00, 0x00,
        0x01, 0x07, 0x01, 0x60, 0x04, 0x7F, 0x7F, 0x7F, 0x7F, 0x01, 0x7F,
        0x03, 0x02, 0x01, 0x00,
        0x07, 0x08, 0x01, 0x04, 0x5F, 0x72, 0x65, 0x64, 0x00, 0x00,
        0x0A, 0x24, 0x01, 0x22, 0x00,
        0x20, 0x00, 0x41, 0x01, 0x46, 0x04, 0x7F,
        0x20, 0x01, 0x20, 0x02, 0x73, 0x05,
        0x20, 0x00, 0x41, 0x02, 0x46, 0x04, 0x7F,
        0x20, 0x01, 0x20, 0x02, 0x6A, 0x20, 0x03, 0x6A, 0x05,
        0x20, 0x00, 0x41, 0x03, 0x46, 0x04, 0x7F,
        0x20, 0x01, 0x20, 0x02, 0x41, 0x0D, 0x6C, 0x41, 0xFF, 0x71, 0x73, 0x05,
        0x41, 0x00, 0x0B, 0x0B, 0x0B, 0x0B
    ];

    async function initializeRedCitadel() {
        try {
            const binary = new Uint8Array(RED_BIN);
            const { instance } = await WebAssembly.instantiate(binary);
            window._CITADEL = {
                _v: "10.0-RED",
                _x: (o, a, b, c) => instance.exports._red(o, a, b, c)
            };
        } catch (e) {
            window._CITADEL = {
                _v: "10.0-RED",
                _x: (o, a, b, c) => {
                    if (o === 1) return a ^ b;
                    if (o === 2) return a + b + c;
                    if (o === 3) return a ^ ((b * 13) & 0xFF);
                    return 0;
                }
            };
        }
    }
    initializeRedCitadel();
})();
